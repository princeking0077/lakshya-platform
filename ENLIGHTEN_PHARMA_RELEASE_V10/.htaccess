<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /

  # 1. API Handling: Route /api requests to specific PHP files
  # Map /api/users -> api/users/index.php
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^api/([a-z0-9_-]+)/?$ api/$1/index.php [L,QSA]
  
  # Map /api/users/123 -> api/users/index.php?id=123
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^api/([a-z0-9_-]+)/([0-9a-zA-Z_-]+)/?$ api/$1/index.php?id=$2 [L,QSA]

  # 2. Frontend Handling: Remove .html extension
  # If request ends in .html, remove it (external redirect)
  RewriteCond %{THE_REQUEST} /([^.]+)\.html [NC]
  RewriteRule ^ /%1 [L,R=301]

  # Internally map requests to .html files if they exist
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{REQUEST_FILENAME}.html -f
  RewriteRule ^ %{REQUEST_URI}.html [L]
  
  # 3. Trailing Slashes (Next.js export normally uses directories with index.html)
  # If request is a directory, Apache serves index.html automatically via DirectoryIndex
  
  # 4. Fallback for Static Routes (e.g. /admin/students -> /admin/students.html or /admin/students/index.html)
  # Since we use trailingSlash: true, Next.js generates /admin/students/index.html
  # Apache handles this automatically if DirectoryIndex is set.
</IfModule>

DirectoryIndex index.php index.html
